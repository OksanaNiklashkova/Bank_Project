# Bank_Project

Этот проект предоставляет возможность обработки банковских данных, с помощью функций: получение актуальных котировок валют и акций, фильтрация и сортировка информации об операциях за месяц, поиск по ключевым словам и номерам телефонов, формирование отчетов по категориям трат.

## Описание
Проект состоит из следующих функций:

-   `make_transactions`: Считывает список транзакций из файла `operations.xlsx` в папке `data`.
-   `filter_by_currency_month`: Отбирает транзакции за период с начала месяца до указанной даты.
-   `get_top_transactions`: Формирует ТОП-5 транзакций по сумме за выбранный период.
-   `filtered_by_card_number`: Сортирует транзакции за выбранный период по номеру карты.
-   `get_card_info`: Формирует отчет по каждой карте: номер карты, сумма расходов за период, сумма кешбэка.
-   `get_exchange_rate`: Запрашивает курс заданной валюты к валюте счета пользователя.
-   `get_stocks_rates`: Запрашивает актуальный курс выбранных акций из индекса S&P500.
-   `main_views`: Обращаясь к вышеперечисленным функциям, формирует JSON-ответ для заполнения Главной страницы приложения.
-   `search_by_target`: Предоставляет возможность поиска в списке транзакций по ключевому слову.
-   `search_by_phones`: Предоставляет возможность поиска в списке транзакций по номерам телефонов.
-   `spending_by_category`: Формирует отчет о транзакциях по выбранной категории за последние 3 месяца от указанной даты.
-   `report_log`: Декоратор, обеспечивающий преобразование возвращаемого `spending_by_category` отчета в JSON-формат и сохранение в файле `report.json`.

## Точка входа
Точкой входа является файл `main.py` в корне проекта. В нем функция `main()` позволяет вам, получив список транзакций из файла, выбрать соответствующие вашим критериям поиска, отсортировать данные и т.д. 
Для обработки данных запускаются те или иные функции, ответы распечатываются в консоль, за исключением сохраненного в файл отчета по категории. По итогу работы этой функции распечатывается общая сумма расходов и указание на файл с полным отчетом.

## Тестирование

Для тестирования работы каждой функции в условиях получения различных входных данных (в том числе, ошибочных и неполных) существует группа тестов в пакете `tests`.
В модуле `conftest.py` содержатся вспомогательные функции (фикстуры), используемые при проведении тестов.

## Установка

Для установки и запуска проекта необходимо выполнить следующие шаги:

1.  **Клонируйте репозиторий:**

    ```
    git clone https://github.com/OksanaNiklashkova/Bank_Project.git
    ```

2.  **Перейдите в папку проекта:**

    ```
    cd Bank_Project
    ```

3.  **Установите зависимости с помощью Poetry:**

    ```
    poetry install
    ```
4. **Запустите файл main.py, чтобы воспользоваться различными методами фильтрации и сортировки транзакций**

    ```
    python main.py
    ```

## Использование

Примеры использования функций:

~~~
Чтение списка транзакций
make_transactions(file_path)
Не требует указания пути в качестве аргумента. Если файл расположен в папке data и имеет верный формат, он будет прочитан корректно.
# OutPut:
    {
        "Дата операции": "14.05.2019 17:44:25",
        "Дата платежа": "14.05.2019",
        "Номер карты": NaN,
        "Статус": "OK",
        "Сумма операции": 1700.0,
        "Валюта операции": "RUB",
        "Сумма платежа": 1700.0,
        "Валюта платежа": "RUB",
        "Кэшбэк": NaN,
        "Категория": "Пополнения",
        "MCC": 6012.0,
        "Описание": "Перевод с карты",
        "Бонусы (включая кэшбэк)": 0,
        "Округление на инвесткопилку": 0,
        "Сумма операции с округлением": 1700.0
    }
    
Фильтрация списка по дате
filter_by_currency_month(transactions: list, act_date: str)
Сортировка по номеру карты
get_top_transactions(transactions: list)
Получение ТОП-5 транзакций
get_top_transactions
Все эти функции работают со списком, полученным от make_transactions и датой, переданной пользователем, получая новые списки, соответсующие условиям.

Получение информации по каждой карте
get_card_info(transactions: list)
Работает со списком, переданным от get_top_transactions, возвращает новый список с резюмирующей информацией

# OutPut:
"cards": [{"last_digits": "4556", "total_spent": 4214.7, "cashback": 170.0},
          {"last_digits": "7197", "total_spent": 24093.81, "cashback": 0.0}]

Получение актуальных котировок валют и акций
get_exchange_rate(currency_op: list, currency_main: str)
get_stocks_rates(stocks: list)
Работают с данными, содержащимися в файле `user_settings.json` и API-сервисом https://api.twelvedata.com.

# OutPut:
"currency_rates": [{"currency": "USD", "rate": 82.625}, {"currency": "EUR", "rate": 93.549}]
"stock_prices": [{"stock": "AAPL", "price": "205.35"}, {"stock": "AMZN", "price": "189.98"}]

Поиск по ключевому слову
search_by_target(transactions)
search_by_phones(transactions)
Работают также со списком, передаваемым функцией make_transactions, возвращают JSON-объекты.

Формирование отчета по категории
spending_by_category(transactions: pd.DataFrame,
                         category: str,
                         date: Optional|str)
Для формирования отчета необходимо передать в функцию список транзакций в виде DataFrame (это реализовано при запуске главной функции проекта - main), категорию (например: Мобильная связь, Супермаркеты, Переводы) и дату отсчета трехмесячного периода в формате ДД.ММ.ГГГГ.
spending_by_category(transactions, "Переводы", "05.08.2019")

~~~

## Зависимости

Проект использует следующие зависимости:

*   Python 3.13
*   Poetry (для управления зависимостями)
*   requests от 2.32.3 до 3.0.0
*   pandas от 2.2.3 до 3.0.0
*   openpyxl от 3.1.5 до 4.0.0

## Лицензия

Этот проект лицензирован по [лицензии MIT](LICENSE).
